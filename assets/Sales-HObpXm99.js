import{r as u,j as t}from"./index-hIJ5fvQW.js";import{e as T}from"./exportToExcel-DW2Cx06d.js";function H(){const[o,k]=u.useState(()=>{const e=localStorage.getItem("sales");return e?JSON.parse(e):[]}),[c,j]=u.useState(()=>{const e=localStorage.getItem("inventory");return e?JSON.parse(e):[]}),[a,b]=u.useState({sku:"",sellPrice:"",quantity:1}),[m,q]=u.useState(""),[h,I]=u.useState(""),[N,S]=u.useState(null),[g,v]=u.useState({sellPrice:"",quantity:1});u.useEffect(()=>{localStorage.setItem("sales",JSON.stringify(o))},[o]),u.useEffect(()=>{localStorage.setItem("inventory",JSON.stringify(c))},[c]);const C=()=>{const{sku:e,sellPrice:s,quantity:l}=a,r=parseInt(l),d=parseFloat(s),n=c.find(i=>i.sku===e);if(!n)return alert("Product not found");if(n.stock<r)return alert("Insufficient stock");const y=n.costPrice,f=(d-y)*r,D={item:n.item,sku:e,sellPrice:d,costPrice:y,quantity:r,profit:f,date:new Date().toISOString()},w=c.map(i=>i.sku===e?{...i,stock:i.stock-r}:i);k([...o,D]),j(w),b({sku:"",sellPrice:"",quantity:1})},E=e=>{if(!window.confirm("Delete this sale?"))return;const l=o[e],r=c.map(n=>n.sku===l.sku?{...n,stock:n.stock+l.quantity}:n),d=[...o];d.splice(e,1),j(r),k(d),localStorage.setItem("inventory",JSON.stringify(r)),localStorage.setItem("sales",JSON.stringify(d))},F=()=>{T(o,"Sales","sales-export.xlsx")},O=e=>{const s=o[e];S(e),v({sellPrice:s.sellPrice,quantity:s.quantity})},J=()=>{const e=o[N];if(!c.find(x=>x.sku===e.sku))return;const l=e.quantity,r=parseInt(g.quantity),d=parseFloat(g.sellPrice),n=e.costPrice,y=r-l,f=c.map(x=>x.sku===e.sku?{...x,stock:x.stock-y}:x);if(f.find(x=>x.sku===e.sku).stock<0)return alert("Insufficient stock for update");const w={...e,sellPrice:d,quantity:r,profit:(d-n)*r},i=[...o];i[N]=w,k(i),j(f),S(null)},p=o.filter(e=>{const s=new Date(e.date).setHours(0,0,0,0),l=m?new Date(m).setHours(0,0,0,0):null,r=h?new Date(h).setHours(0,0,0,0):null;return(!l||s>=l)&&(!r||s<=r)}),P=p.reduce((e,s)=>e+s.sellPrice*s.quantity,0),Q=p.length?(P/p.length).toFixed(2):0;return t.jsxs("div",{className:"p-4",children:[t.jsx("h2",{className:"text-2xl font-bold mb-4",children:"ðŸ’° Sales"}),t.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[t.jsxs("div",{className:"bg-green-100 dark:bg-green-800 p-4 rounded shadow",children:[t.jsx("h4",{className:"text-lg font-semibold",children:"Total Sales"}),t.jsxs("p",{className:"text-xl font-bold",children:["â‚¹ ",P.toFixed(2)]})]}),t.jsxs("div",{className:"bg-yellow-100 dark:bg-yellow-800 p-4 rounded shadow",children:[t.jsx("h4",{className:"text-lg font-semibold",children:"Average Sale"}),t.jsxs("p",{className:"text-xl font-bold",children:["â‚¹ ",Q]})]})]}),t.jsxs("div",{className:"bg-white dark:bg-gray-800 p-4 rounded shadow mb-6",children:[t.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Make a Sale"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("select",{value:a.sku,onChange:e=>b({...a,sku:e.target.value}),className:`w-full p-2 rounded border border-gray-300 bg-white text-gray-800 \r
             dark:bg-gray-800 dark:border-gray-600 dark:text-white`,children:[t.jsx("option",{value:"",children:"Select Product"}),c.filter(e=>e.stock>0).map(e=>t.jsxs("option",{value:e.sku,children:[e.item," (",e.sku,")"]},e.sku))]}),t.jsx("input",{type:"number",placeholder:"Sell Price",value:a.sellPrice,onChange:e=>b({...a,sellPrice:e.target.value}),className:`w-full p-2 rounded border border-gray-300 bg-white text-gray-800 \r
             dark:bg-gray-800 dark:border-gray-600 dark:text-white`}),t.jsx("input",{type:"number",placeholder:"Quantity",value:a.quantity,onChange:e=>b({...a,quantity:e.target.value}),className:`w-full p-2 rounded border border-gray-300 bg-white text-gray-800 \r
             dark:bg-gray-800 dark:border-gray-600 dark:text-white`})]}),a.sku&&a.sellPrice&&a.quantity&&(()=>{const e=c.find(r=>r.sku===a.sku),s=(e==null?void 0:e.costPrice)||0,l=(parseFloat(a.sellPrice)-s)*parseInt(a.quantity);return t.jsxs("p",{className:`mt-2 text-sm font-medium ${l<0?"text-red-600 dark:text-red-400":"text-green-700 dark:text-green-400"}`,children:[l<0?"Loss : -":"Profit :"," â‚¹"," ",Math.abs(l).toFixed(2)]})})(),t.jsx("button",{onClick:C,disabled:!a.sku||!a.sellPrice||!a.quantity,className:"mt-4 px-4 py-2 text-white rounded bg-blue-600 hover:bg-blue-700 disabled:opacity-50",children:"Complete Sale"})]}),t.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium",children:"From:"}),t.jsx("input",{type:"date",value:m,onChange:e=>q(e.target.value),className:`w-full p-2 rounded border border-gray-300 bg-white text-gray-800 \r
      dark:bg-gray-800 dark:border-gray-600 dark:text-white`}),m&&t.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:new Date(m).toLocaleDateString("en-GB")})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium",children:"To:"}),t.jsx("input",{type:"date",value:h,onChange:e=>I(e.target.value),className:`w-full p-2 rounded border border-gray-300 bg-white text-gray-800 \r
      dark:bg-gray-800 dark:border-gray-600 dark:text-white`}),h&&t.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-1",children:new Date(h).toLocaleDateString("en-GB")})]})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"min-w-full bg-white dark:bg-gray-800 rounded shadow",children:[t.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700",children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-left p-2 ",children:"Date "}),t.jsx("th",{className:"text-left p-2 ",children:"Item"}),t.jsx("th",{className:"text-left p-2 ",children:"SKU"}),t.jsx("th",{className:"text-left p-2 ",children:"Sell Price "}),t.jsx("th",{className:"text-left p-2 ",children:"Cost Price "}),t.jsx("th",{className:"text-left p-2 ",children:"Qtn "}),t.jsx("th",{className:"text-left p-2 ",children:"Profits "}),t.jsx("th",{className:"text-left p-2 ",children:"Actions "})]})}),t.jsx("tbody",{children:p.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:"8",className:"p-4 text-center text-gray-500",children:"No sales found."})}):[...p].sort((e,s)=>new Date(s.date)-new Date(e.date)).map((e,s)=>t.jsxs("tr",{className:"border-t border-gray-300 dark:border-gray-600",children:[t.jsx("td",{className:"p-2",children:new Date(e.date).toLocaleString("en-IN",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1})}),t.jsx("td",{className:"p-2",children:e.item}),t.jsx("td",{className:"p-2",children:e.sku}),t.jsxs("td",{className:"p-2",children:["â‚¹ ",e.sellPrice]}),t.jsxs("td",{className:"p-2",children:["â‚¹ ",e.costPrice]}),t.jsx("td",{className:"p-2",children:e.quantity}),t.jsxs("td",{className:`px-4 py-2 text-sm font-medium ${e.profit<0?"text-red-600":"text-green-600"}`,children:["â‚¹ ",e.profit.toFixed(2)]}),t.jsxs("td",{className:"p-2",children:[t.jsx("button",{onClick:()=>O(s),className:"text-blue-600 hover:underline mr-2",children:"Edit"}),t.jsx("button",{onClick:()=>E(s),className:"text-red-600 hover:underline",children:"Delete"})]})]},`${e.sku}-${e.date}`))})]})}),N!==null&&t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:t.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded shadow w-80",children:[t.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Edit Sale"}),t.jsx("input",{type:"number",className:"w-full p-2 mb-2 border rounded dark:bg-gray-700",placeholder:"Sell Price",value:g.sellPrice,onChange:e=>v({...g,sellPrice:e.target.value})}),t.jsx("input",{type:"number",className:"w-full p-2 mb-4 border rounded dark:bg-gray-700",placeholder:"Quantity",value:g.quantity,onChange:e=>v({...g,quantity:e.target.value})}),t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{onClick:()=>S(null),className:"px-4 py-1 bg-gray-500 text-white rounded",children:"Cancel"}),t.jsx("button",{onClick:J,className:"px-4 py-1 bg-blue-600 text-white rounded",children:"Save"})]})]})}),t.jsx("button",{onClick:F,className:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700",children:"Export Sales Table"})]})}export{H as default};
